---
title: اختبار Neon EVM مع عقود Robonomics الذكية
date: 2022-10-03
published: true
locale: 'ar'
tags: ['Robonomics في إيثريوم', 'التعاونات', 'العقود الذكية', 'Neon']
cover_image: /blog/images/testing-neon-with-robonomics/blog_cover_neon_multi-agent.jpg
description: "كانت غاية هذه الاختبارات هي التحقق من جاهزية منصة Neon للانتقال إلى مرحلة الإنتاج باستخدام عقود Robonomics الذكية، التي تسمح لأنظمة السيبر-فيزيائية (الروبوتات) بإجراء معاملات تقنية اقتصادية."
abstract: ""
---

## ملخص

كانت غاية هذه الاختبارات هي التحقق من جاهزية [منصة Neon](https://neon-labs.org/) للانتقال إلى مرحلة الإنتاج باستخدام عقود Robonomics الذكية، التي تسمح لأنظمة السيبر-فيزيائية (الروبوتات) بإجراء معاملات تقنية اقتصادية.

في شبكة Robonomics، يتم إنشاء تفاعل بين طرفين: الطالب - الذي يطلب الخدمة، ويُرسل وصفًا للمهمة التقنية ويحول الأموال لتنفيذها؛ والمنفذ - الذي يقوم بتقديم الخدمة. تم اختبار سيناريو نموذجي، حيث يتم توقيع عقد مسؤولية بين الطالب والمنفذ - تلته التحقق من العمل الناتج من قبل طرف ثالث، ودفع عمولة للعقد الذي رافق بين الطرفين.

لهذا المثال، تم استخدام محاكاة لذراع روبوتية، تم طلب منها أداء سلسلة من الإجراءات. كانت الاختبارات ناجحة.

## نطاق وأهداف الاختبار

يعمل مهندسو [أنظمة الوكلاء المتعددين](https://multi-agent.io/) مع [شبكة Robonomics](https://robonomics.network/) منذ عدة سنوات. تم إنشاء أول تنفيذ لشبكة Robonomics لشبكة Ethereum. إنه مجموعة من العقود الذكية للتواصل بين الآلة والآلة.

يتمثل النواة الأساسية لشبكة Robonomics في عقد [المسؤولية](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Liability.sol)، وهو عقد ذكي يكرر العلاقة النموذجية بين زبون الخدمة (الطالب) ومقدم الخدمة (المنفذ)، ويتضمن المعلمات التقنية والاقتصادية للمعاملة بينهما. يمكن أن تكون الأطراف إما وكيلًا ذاتيًا وشخصًا (تفاعل إنساني-آلة)، أو مجرد اثنين من الوكلاء الذاتيين (تفاعل آلة-آلة). يبث الطالب والمنفذ رسائل بالمعلمات التي تحتوي على البارامترات الفنية والاقتصادية للمعاملة.يتم توفير الصفقة الفنية الاقتصادية الخاصة بهم، ومن ثم يتم توفير ختام الصفقة من قبل عقد خاص - مقدم الخدمة - الذي يبحث عن تطابق لهذه المعايير. يتم التحكم في مقدمي الخدمات من قبل [Lighthouse](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Lighthouse.sol)، وهو عقد ذكي خاص ينفذ صفقة عندما يقوم مقدم الخدمة بإقامة تطابق سوقي بين الأطراف.

هناك ثلاث سيناريوهات يمكن أن يحدث فيها تنفيذ التزام:

1. التزام بسيط (بدون التحقق من النتيجة النهائية، ودون دفع عمولة لمقدمي الخدمات)
2. التزام مع دفع عمولة لمقدم الخدمة
3. التزام مع دفع عمولة لمقدم الخدمة والتحقق من النتائج بمساعدة طرف ثالث - شبكة المراقبة.

غرض هذا الاختبار هو اختبار السيناريو الأكثر تعقيدًا، الثالث من Robonomics على منصة Neon EVM.

## وصف سيناريوهات الاختبار

مع تطوير المناطق الصناعية والبنية التحتية للمدن الحديثة، من المرجح بشدة ظهور المؤسسات والخدمات المؤتمتة بالكامل التي تتحكم فيها أنظمة السيبر-الفيزيائية (CPS) والتي تقدم خدماتها كوكلاء مستقلين. في هذا الصدد، يمكننا أيضًا توقع تشكيل شبكات من CPS المستقلة من أجل زيادة سرعة وجودة التواصل في عملية الإنتاج وتقديم الخدمات.

من أجل الاستفادة الكاملة من إمكانيات العقود الذكية، تم اختيار سيناريو للتفاعل بين وكيلين اقتصاديين مستقلين. لننظر إلى دورة حياة المسؤولية في شبكة Robonomics:

![دورة حياة المسؤولية](/blog/images/testing-neon-with-robonomics/step-by-step-3.jpg)

توضح الشكل أعلاه أن مقدم خدمة شبكة Robonomics يستدعي عقد Lighthouse، الذي بدوره يستدعي [مصنع العقود](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Factory.sol) لإنشاء عقد المسؤولية. يحتوي عقد المسؤولية على بيانات حول الصفقة، مثل شروط العمل، الدفع عن الخدمة، عنوان المحقق والموعد النهائي.

لمعرفة المزيد عن حالات الاستخدام المحتملة لـ Robonomics، تفضل بزيارة صفحة Robonomics [R&D](https://wiki.robonomics.network/docs/en/r-and-d-based-on-robonomics-network/#launching-a-drone-under-the-control-of-a-decentralized-computer)!

لتكرار بنية Robonomics بأكملها على شبكة Neon، سنقوم بتنفيذ سيناريو إطلاق روبوت من خلال عقد مسؤولية.مماثل لهذا [المثال](https://wiki.robonomics.network/docs/ar/kuka/). إذا كان بإمكان تكرار النص البرمجي، فسوف تعمل جميع الوظائف.

## المنتجات النهائية

يتوفر الشيفرة المصدرية لعقود Robonomics [هنا](https://github.com/airalab/robonomics_contracts).
تستخدم العقود العديد من ميزات Ethereum VM والتي تشمل:

- ERC20 [XRT](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/XRT.sol) رمز
- [Factory](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Factory.sol)
- عقد خاص بـ [ENS](https://github.com/airalab/robonomics_contracts/blob/master/contracts/ens/ENS.sol)
- [Proxy](https://github.com/airalab/robonomics_contracts/blob/master/contracts/misc/SharedCode.sol) للعقود
- معدلات وأدوار متنوعة في العقود

عناوين العقود في شبكة Neon devnet https://devnet.neonevm.org

| اسم العقد  | العنوان                                    |
|----------------|--------------------------------------------|
| الترحيلات     | 0x1DC538bE2C8572509a571B150f11aB55E52EF12E |
| ENS            | 0xa7AEa12F60D0278F01e14DBC7cc459d04d051406 |
| مزاد هولندي   | 0xF44F8803548D72Dbc3E28340EFD7b5328aa4F058 |
| المسؤولية      | 0xA694196351dc1488e3884eCc6b650F0d8D55346a |
| المنارة     | 0x80FB5CC4c396E272b56700E6ffF5DBf4661013A8 |
| XRT            | 0x3322d7D99cF65Cab5A92073c928b5E9674af3c29 |
| PublicAmbix    | 0x85c03bE5ccFf11E79a0A776D183eF067590549d1 |
| Factory        | 0xCFa833bF0D46369D9024f95c9C8dFa1E4a07806C |
| PublicResolver | 0xAC9E9AA8A4cB524FE87f2b14489F1D6bE68dc46e |

[Source code](https://github.com/Multi-Agent-io/neon-kuka-demo) للسيناريو

## التغييرات التي تم إجراؤها على العقود الأصلية

تم كتابة العقود لـ Solidity 0.5.0. وبالتالي، لم يكن هناك حاجة لأي تغييرات عند نشر واستخدام العقود.

## سير العمل للاختبار

بشكل عام، يتكون الاختبار من إرسال رسائل متطابقة من وكيل إلى آخر.

بعد ذلك، يجد الواعد عقدًا جديدًا للالتزام في الشبكة ويبدأ في تنفيذه. عند اكتمال العمل، يتم إرسال رسالة بالنتيجة، التي يتم بعد ذلك تسجيلها في العقد.

تتوفر التعليمات الخطوة بالخطوة للبدء في [README.md](https://github.com/Multi-Agent-io/neon-kuka-demo/blob/main/README.md)

## نتائج الاختبار بالتفصيل

فيديو لعملية الاختبار

<YouTube id="https://youtu.be/fYJVF7KrNnI" posterQuality="max" />

![Liability](/blog/images/testing-neon-with-robonomics/liability.jpg)

عند بدء المحاكاة، يتم إنشاء رسالة عرض، وتأتي رسالة طلب من الواعد، بعد ذلك يتم إنشاء عقد الالتزام باستخدام وظيفة createLiability في عقد Lighthouse. بمساعدة عقد XRT، يتم نقل الرموز من عنوان الواعد إلى عنوان عقد الالتزام.

بعد اكتشاف عقد الالتزام الجديد على شبكة Neon devnet، يبدأ الوكيل في العمل. يتم كتابة نتيجة العمل (التلميتري) في ملف وإرساله إلى IPFS، ويتم حفظ الهاش من الملف كنتيجة.

بعد اكتمال العمل، يتم إنهاء عقد الالتزام باستخدام وظيفة finalizeLiability() في عقد Lighthouse ويتم نقل الرموز من عنوان الالتزام إلى عناوين الواعد والمحقق.

أظهر تنفيذ المحاكاة بنجاح أن جميع العقود عملت بشكل صحيح وأن منصة Neon تعمل.

## عيوب منصة Neon

### فشل Truffle إذا لم يحصل على استجابة من الشبكة

أثناء عملية نشر العقود، تبين أن البروكسي لا يعود دائمًا بالرد في الوقت المناسب، ولهذا السبب ينتهي Truffle بخطأ:

<RbCode>

```sh
TypeError: Cannot read properties of null (reading 'from')                                    
    at Web3InterfaceAdapter.(<مجهول>) (/usr/lib/node_modules/truffle/build/webpack:/packages/interface-adapter/dist/adapter/web3/index.js:71:1)                                           
    at Generator.next (<مجهول>)                                                          
    at fulfilled (/usr/lib/node_modules/truffle/build/webpack:/packages/interface-adapter/dist
/adapter/web3/index.js:5:43)                                                                  
    at runMicrotasks (<مجهول>)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
Truffle v5.5.23 (النواة: 5.5.23)
Node v16.14.0

لم يكن من الممكن العثور على علاقة بين شروط الاختبار وحدوث خطأ، ولكن من المحتمل بشكل كبير أن Neon EVM لا يمكنه إرسال إيصال للمعاملة، ولا يمكن لـ Truffle معالجة استجابة فارغة.

إذا قمنا بإضافة فترة انتهاء وإعادة المحاولة هنا [index.ts#L75](https://github.com/trufflesuite/truffle/blob/develop/packages/interface-adapter/lib/adapter/web3/index.ts#L75)، فإن عملية النشر يجب أن تستمر دون أخطاء.

### لا توجد نقطة نهاية WS/WSS

لا تحتوي Neon EVM على نقطة نهاية WS/WSS على عكس Ethereum، مما يجعل من المستحيل الاشتراك في الأحداث من الشبكة. لذلك، خلال الاختبار، قمنا بمراقبة الأحداث يدويًا.

### لا توجد أسماء أحداث

تعيد Neon EVM وصفًا ضعيفًا للأحداث بعد عملية المعاملة، على سبيل المثال:

<RbCode>[كائن]
    },
...
```
</RbCode>

بدلاً من 0، 1، وما إلى ذلك، كنا نتوقع رؤية الأحداث المسماة.

## الاستنتاج

باستخدام منصة Neon EVM، تم اختبار سيناريو بنجاح حيث تمت ختم عقد مسؤولية بين Promisee و Promisor مع التحقق اللاحق من نتيجة العمل الذي قام به طرف ثالث. بالإضافة إلى ذلك، شارك مزود خدمة، الذي قام بالتحقق من تطابق العرض والطلب بين الأطراف، وتلقى عمولة عن هذا العمل.

استخدمت العرض محاكاة لذراع روبوتية تم توظيفها لأداء سلسلة من الإجراءات. ونتيجة للعمل، أرسل الروبوت ملفًا يحتوي على بيانات تلميترية تم استلامها أثناء العمل.

على الرغم من بعض الخصوصيات في عمل الشبكة، في النهاية، أظهرت جميع العقود المشاركة قابليتها للتشغيل في بيئة Neon.