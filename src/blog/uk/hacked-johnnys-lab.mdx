---
title: Взламано Лабораторію Джонні
date: 2024-06-25
published: true
locale: 'uk'
tags: ['Events', 'Online school', 'Web3', ]
cover_image: /blog/images/hacked-johnnys-lab/cover.png
description: 'Недавно відбулося подія “Взламати Лабораторію Джонні” від Robonomics, і я вважаю, що я взламав її в певному сенсі! Окрім першої спроби, яку я програв через непорозуміння правил, я виграв кожне коло, в якому брав участь, і ось коротка історія “як”.'
abstract: "Привіт! ПаТара на лінії. Недавно відбулося подія “Взламати Лабораторію Джонні” від Robonomics, і я вважаю, що я взламав її в певному сенсі! Окрім першої спроби, яку я програв через непорозуміння правил, я виграв кожне коло, в якому брав участь, і ось коротка історія “як”. "
---

Отже, короткий і необхідний підсумок правил: 12 слів у змішаному порядку, 5-хвилинне відео TurtleBot 4, що блукає лабораторією
і псування порядку слів мнемонічної фрази, 5-20 учасників, які бажають перемогти, і вільна неділя, щоб придумати стратегію.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/0.png" alt="Game Interface" />

Я дещо знаю про програмування, у мене є непоганий ноутбук і майже жодних навичок у розпізнаванні зображень. Більше того, 
Я вирішив грати чесно, що означає відсутність завантаження відео, відсутність зловживання швидкістю відтворення, відсутність навігації по плейбару. 
Тому вибрана стратегія була добре відомим методом брутфорсу. Звучить більше як хакінг, ніж що інше.
Що ми тут маємо: набір з 12 слів у змішаному порядку. Це дає нам 12! (факторіал) варіантів фраз 
(479’001’600 щоб бути точним). Досить велика кількість для обробки!


## Стратегія 1: дурний і прямолінійний.

Ну що ще мені потрібно, просто йди і сортуй! Але ось перший трюк: 12! мнемонічних фраз просто не влазили 
мої 64 ГБ ОЗУ! Я отримав помилку SIGTERM у консолі IDE. 
Тож я створив [ітератор](https://docs.python.org/3/library/itertools.html#itertools.permutations) і розпочав процес.
Мені знадобився деякий час, не знаю точно, скільки, але протягом 30 секунд, щоб обчислити кількість комбінацій.
Просто оціночний запуск. Але справа в тому, що мій ноутбук навіть не включав свої вентилятори на максимум! Було завантажено лише одне ядро. 

Я шукав в Інтернеті пакет Python [multiprocessing](https://docs.python.org/3/library/multiprocessing.html), щоб завантажити всі 
логічні ядра мого процесора (20 з них) для паралельних обчислень. В іншому випадку це була б вічна подорож. 
Але для цього мені довелося розділити мій ітератор на 12 частин. Пакети multiprocessing itertools дійно працюють разом, 
але коли весь набір варіантів знаходиться в ОЗУ. Це не було моєю справою, тому було виконано наступне:

<RbImage zoom src="/blog/images/hacked-johnnys-lab/1.png" alt="Parallelizing"/>


З того моменту і назавжди я буду використовувати цю стратегію, щоб мій монітор завантаження ЦП виглядав так:

<RbImage zoom src="/blog/images/hacked-johnnys-lab/1_1.png" alt="CPU Load"/>


Я вважаю, що це скоротило час виконання до близько 5 секунд. Я отримав найкращий спосіб ітерувати через 
комбінації, але їх було просто занадто багато! Перший крок пеедбачав виконання приблизно 480 мільйонів 
екструзій в мережі. Вузол просто забанив би мене за DDOS, і навіть без цього це тривало б вічно!

<RbImage zoom src="/blog/images/hacked-johnnys-lab/2.png" alt="1st Attempt"/>


Лише з метою налагодження я запустив сценарій (для взаємодії з вузлом я використовував пакет 
[py-substrate-interface](https://pypi.org/project/substrate-interface/1.0.3/) і помітив, що перед викликом 
виконання я отримував помилки типу _недійсна фраза мнемоніки_. Підказка! Якщо б я міг перевірити комбінацію на місці, 
я б зекономив тонни часу! Парсинг GitHub привів мене до 
[цього](https://github.com/polkascan/py-substrate-interface/blob/master/substrateinterface/keypair.py#L170) 
рядка коду, і я додав перевірку комбінації до свого сценарію. Це зменшило кількість потенційних екструзій до приблизно 39’000’000 в 12 разів швидше!
Але все одно, 39 мільйонів викликів забанили б мене назавжди, тому мені потрібно було ще більше розкопок. Як я можу значно скоротити

<RbImage zoom src="/blog/images/hacked-johnnys-lab/3.png" alt="2nd Attempt"/>


кількість обчислень? Ну, трохи зраджуючи свою початкову стратегію. Подивіться, я мав уникати перегляду відео, 
“хакер, який навіть не потребує відео”, але математика змусила мене змінити свою думку. Змінити її на стратегію в 132 рази швидше. 
Нижче пояснення: 
З цим мені потрібно було знати лише дві правильні позиції слів у фразі (одне зайняло б занадто багато часу, експериментально підтверджено).

<RbImage zoom src="/blog/images/hacked-johnnys-lab/4.png" alt="2 Words Insertion"/>


Я б ітерував через 10! комбінацій, вставляв два слова на правильні позиції та перевіряв фразу, 
зменшуючи варіанти до приблизно 300’000, досить значне зменшення! Більше того, набір комбінацій 10! вліз у мою ОЗУ, чудово! 
свій власний локальний вузол Robonomics, синхронізований з ланцюжком і запитати його про баланс рахунку!

<RbImage zoom src="/blog/images/hacked-johnnys-lab/5.png" alt="3rd Attempt"/>


Крім того, замість того, щоб намагатися передавати всі маркери кожні 300 тисяч разів і викликати для цього загальнодоступний вузол, я вирішив встановити
створити мій власний локальний вузол Robonomics, синхронізований із ланцюжком, і запитати в нього кінцевий баланс адреси облікового запису!
Запит значно «простіший», ніж зовнішній. Після цілої ночі синхронізації (я встановив обмеження кешу, щоб мій
ноутбук не вибухне з даними ланцюга в його ПЗУ) Я спробував і.. це була катастрофа. Мережеві транзакції
(навіть у локальному хості) зайняло надто багато часу. Я навіть не чекав до кінця, очевидно, це було набагато повільніше, ніж
перегляд цілого відео. Якби я міг знати точну адресу рахунку! Але для цього мені потрібна мнемонічна фраза… **Чи я справді?**

Подивись. Правила кажуть, що в бажаному обліковому записі **точно** 42 XRT. Чому б мені не отримати всі активні адреси в мережі,
відфільтрувати їх, маючи точно 42 XRT і порівняти кожну згенеровану адресу зі списком можливих цілей 
(близько 20, зменшуючись до 1 в кінці). Легко сказати і зробити. 

Тепер, після ще однієї модифікації мого скрипта, я нарешті зробив лише один запит і одну транзакцію, які безперечно 
дають мені бажаний приз.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/6.png" alt="4th Attempt"/>


Тепер, після того, як я переглянув 25 секунд відео (тим часом заповнюючи слова мнемоніки), 
мені б вистачило максимум 30 секунд, щоб вкрасти винагороду. Взламав це.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/7.png" alt="Discord Bot Notification"/>



