---
title: Лаборатория Джонни Взломана
date: 2024-06-25
published: true
locale: 'ru'
tags: ['Events', 'Online school', 'Web3', ]
cover_image: /blog/images/hacked-johnnys-lab/cover.png
description: 'Недавно прошло событие «Взлом Лаборатории Джонни» от Robonomics, и я действительно считаю, что смог взломать ее! За исключением очень первой попытки, которую я проиграл из-за недопонимания правил, я выиграл каждый раунд, в котором принимал участие, и вот небольшая история «как это было».'
abstract: "Привет! На связи PaTara. Недавно прошло событие «Взлом Лаборатории Джонни» от Robonomics, и я действительно считаю, что смог взломать ее! За исключением очень первой попытки, которую я проиграл из-за недопонимания правил, я выиграл каждый раунд, в котором принимал участие, и вот небольшая история «как это было». "
---

Итак, краткий и необходимый обзор правил: 12 слов в смешанном порядке, 5-минутное видео о том, как TurtleBot 4 бродит по лаборатории и нарушает порядок слов мнемонической фразы, 5–20 участников, желающих победить, и свободное воскресенье для придумывания стратегии.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/0.png" alt="Game Interface" />

Я довольно хорошо разбираюсь в программировании, у меня есть хороший ноутбук и почти нет навыков распознавания изображений. Более того, 
Я решил играть честно, что означает отсутствие загрузки видео, злоупотребления скоростью воспроизведения, навигации по плейбару. 
Так что выбранная стратегия была хорошо знакомым методом брутфорса. Звучит больше как взлом, чем что-то еще.
Что у нас здесь: набор из 12 слов в перемешанном порядке. Это дает нам 12! (факториал) вариантов фраз 
(479’001’600, чтобы быть точным). Довольно большое количество для обработки!


## Стратегия 1: глупая и прямолинейная.

Ну что еще мне нужно, просто иди и разберись! Но вот первый трюк: 12! мнемонических фраз просто не помещаются 
мои 64 ГБ ОЗУ! Я получил ошибку SIGTERM в консоли IDE. 
Поэтому я создал [итератор](https://docs.python.org/3/library/itertools.html#itertools.permutations) и запустил процесс.
Мне потребовалось некоторое время, не уверен точно, сколько, но в пределах 30 секунд, чтобы подсчитать количество комбинаций.
Просто оценочный запуск. Но дело в том, что мой ноутбук даже не включил максимальную скорость вентиляторов! Был загружен только один ядро. 

Я нашел в Интернете пакет Python [multiprocessing](https://docs.python.org/3/library/multiprocessing.html), чтобы загрузить все 
логические ядра моего процессора (20 из них) для параллельных вычислений. В противном случае это было бы вечное путешествие. 
Но для этого мне пришлось разделить свой итератор на 12 частей. Пакеты multiprocessing itertools действительно работают вместе, 
но когда вся группа вариантов находится в ОЗУ. Это не было моим случаем, поэтому было выполнено следующее:

<RbImage zoom src="/blog/images/hacked-johnnys-lab/1.png" alt="Parallelizing"/>


С того момента и далее я использовал бы эту стратегию, чтобы мой монитор загрузки ЦП выглядел так:

<RbImage zoom src="/blog/images/hacked-johnnys-lab/1_1.png" alt="CPU Load"/>


Я считаю, что это сократило время выполнения до примерно 5 секунд. Я нашел лучший способ перебора 
комбинаций, но их было просто слишком много! Первым шагом было выполнение примерно 480 миллионов 
экструзий в сети. Узел просто забанил бы меня за DDOS, и даже без этого это заняло бы вечность!

<RbImage zoom src="/blog/images/hacked-johnnys-lab/2.png" alt="1st Attempt"/>


Просто из-за отладочной цели я запустил скрипт (для связи с узлом использовал 
пакет [py-substrate-interface](https://pypi.org/project/substrate-interface/1.0.3/) и заметил, что перед вызовом 
выполнения у меня возникали ошибки, такие как _недопустимая мнемоническая фраза_. Подсказка! Если бы я мог проверить комбинацию на предмет 
валидации на месте, я бы сэкономил кучу времени! Парсинг GitHub привел меня к 
[этой](https://github.com/polkascan/py-substrate-interface/blob/master/substrateinterface/keypair.py#L170) 
строке кода, и я добавил проверку комбинации в свой скрипт. Это сократило количество потенциальных экструзий до примерно 39’000’000 в 12 раз быстрее!
Но все равно, 39 миллионов вызовов забанили бы меня навсегда, поэтому мне нужно было еще больше копаться. Как я мог существенно сократить

<RbImage zoom src="/blog/images/hacked-johnnys-lab/3.png" alt="2nd Attempt"/>


Но все равно, 39 миллионов звонков забанят меня навсегда, поэтому мне нужно было больше копать. Как я мог бы значительно сократить количество вычислений? Ну, немного предав свою первоначальную стратегию. Понимаете, я собирался избегать просмотра видео, 
«хакер, который даже не будет нуждаться в видео», но математика заставила меня передумать. Перейти к стратегии в 132 раза быстрее. 
Ниже объяснение: 
Теперь мне нужно было знать только два правильных положения слов в фразе (одно заняло бы слишком много времени, проверено экспериментом).

Ниже приведено объяснение:

<RbImage zoom src="/blog/images/hacked-johnnys-lab/4.png" alt="2 Words Insertion"/>


При этом мне нужно было знать только два правильных положения слов во фразе (одно заняло бы слишком много времени, проверено экспериментом).
Я бы перебрал 10! комбинаций, вставил два слова в правильные позиции и проверил фразу,
сократив количество вариантов примерно до 300’000 — это значительное уменьшение! Более того, 10! наборов комбинаций поместились в моей оперативной памяти, отлично!!

<RbImage zoom src="/blog/images/hacked-johnnys-lab/5.png" alt="3rd Attempt"/>


Также, вместо того, чтобы пытаться передавать все токены каждые 300к раз и вызывать общедоступный узел для этого, я решил установить 
Запрос намного «проще», чем экструзия. После целой ночи синхронизации (я установил предел кэша, чтобы мой 
Query is way “easier” than an extrinsic. After a whole night of synchronizing (I’ve set a cache limit so that my 
laptop won’t blow up with chain data in its ROM) I gave it a try and.. this was a disaster. Network transactions 
просмотр целого видео. Если бы я только мог знать точный адрес счета! Но для этого мне нужна мнемоническая фраза… **Или действительно нужна?** 
просмотр видео целиком. Если бы я только мог знать точный адрес счета! Но для этого мне нужна мнемоническая фраза… **Или мне действительно нужно?**

Посмотрите. Правила гласят, что желаемый аккаунт имеет **ровно** 42 XRT. Почему бы мне не получить все активные адреса в сети,
отфильтровать их, имея ровно 42 XRT и сравнить каждый сгенерированный адрес с возможными целями 
(около 20, уменьшаясь до 1 в конце). Легко сказать и сделать. 

Теперь, после еще одной модификации моего скрипта, я наконец-то сделал только один запрос и одну транзакцию, которые, безусловно, 
дали бы мне желаемый приз.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/6.png" alt="4th Attempt"/>


Теперь, после того, как я посмотрел 25 секунд видео (при этом заполняя слова мнемоники), 
мне было бы нужно всего 30 секунд максимум, чтобы украсть награду. Взломал это.

<RbImage zoom src="/blog/images/hacked-johnnys-lab/7.png" alt="Discord Bot Notification"/>



