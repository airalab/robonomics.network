import{w as v}from"./runtime-dom.esm-bundler.BpsM3NMx.js";import{c as g,o as y,i as _,q as x,m as E,r as c}from"./runtime-core.esm-bundler.Ck1WV_rV.js";import{_ as C}from"./_plugin-vue_export-helper.DlAUqK2U.js";const f="hcaptcha-api-script-id",b="_hcaptchaOnLoad";let p,w;const h=new Promise((t,e)=>{p=t,w=e});function I(t){if(window.hcaptcha)return p(),h;if(document.getElementById(f))return h;window[b]=p;const e=$(t),r=document.createElement("script");return r.id=f,r.src=e,r.async=!0,r.defer=!0,r.onerror=i=>{console.error("Failed to load api: "+e,i),w("Failed to load api.js")},document.head.appendChild(r),h}function $(t){let e=t.apiEndpoint;return e=n(e,"render","explicit"),e=n(e,"onload",b),e=n(e,"recaptchacompat",t.reCaptchaCompat===!1?"off":null),e=n(e,"hl",t.language),e=n(e,"sentry",t.sentry),e=n(e,"custom",t.custom),e=n(e,"endpoint",t.endpoint),e=n(e,"assethost",t.assethost),e=n(e,"imghost",t.imghost),e=n(e,"reportapi",t.reportapi),e}function n(t,e,r){if(r!=null){const i=t.includes("?")?"&":"?";return t+i+e+"="+encodeURIComponent(r)}return t}var k=(t,e)=>{for(const[r,i]of e)t[r]=i;return t};const A={name:"VueHcaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String,default:void 0},size:{type:String,default:void 0},tabindex:{type:String,default:void 0},language:{type:String,default:void 0},reCaptchaCompat:{type:Boolean,default:!0},challengeContainer:{type:String,default:void 0},rqdata:{type:String,default:void 0},sentry:{type:Boolean,default:!0},custom:{type:Boolean,default:void 0},apiEndpoint:{type:String,default:"https://hcaptcha.com/1/api.js"},endpoint:{type:String,default:void 0},reportapi:{type:String,default:void 0},assethost:{type:String,default:void 0},imghost:{type:String,default:void 0}},data:()=>({widgetId:null,hcaptcha:null,renderedCb:null}),mounted(){return I(this.$props).then(this.onApiLoaded).catch(this.onError)},unmounted(){this.teardown()},destroyed(){this.teardown()},methods:{teardown(){this.widgetId&&(this.hcaptcha.reset(this.widgetId),this.hcaptcha.remove(this.widgetId))},onApiLoaded(){this.hcaptcha=window.hcaptcha;const t={sitekey:this.sitekey,theme:this.theme,size:this.size,tabindex:this.tabindex,callback:this.onVerify,"expired-callback":this.onExpired,"chalexpired-callback":this.onChallengeExpired,"error-callback":this.onError,"open-callback":this.onOpen,"close-callback":this.onClose};this.challengeContainer&&(t["challenge-container"]=this.challengeContainer),this.widgetId=this.hcaptcha.render(this.$el,t),this.rqdata&&this.hcaptcha.setData(this.widgetId,{rqdata:this.rqdata}),this.onRendered()},execute(){this.widgetId?(this.hcaptcha.execute(this.widgetId),this.onExecuted()):this.renderedCb=()=>{this.renderedCb=null,this.execute()}},executeAsync(){if(this.widgetId)return this.onExecuted(),this.hcaptcha.execute(this.widgetId,{async:!0});let t;const e=new Promise(r=>{t=r});return this.renderedCb=()=>{this.renderedCb=null,t()},e.then(this.executeAsync)},reset(){this.widgetId?(this.hcaptcha.reset(this.widgetId),this.onReset()):this.$emit("error","Element is not rendered yet and thus cannot reset it. Wait for `rendered` event to safely call reset.")},onRendered(){this.$emit("rendered"),this.renderedCb&&this.renderedCb()},onExecuted(){this.$emit("executed")},onReset(){this.$emit("reset")},onError(t){this.$emit("error",t),this.reset()},onVerify(){const t=this.hcaptcha.getResponse(this.widgetId),e=this.hcaptcha.getRespKey(this.widgetId);this.$emit("verify",t,e)},onExpired(){this.$emit("expired")},onChallengeExpired(){this.$emit("challengeExpired")},onOpen(){this.$emit("opened")},onClose(){this.$emit("closed")}}},D={id:"hcap-script"};function F(t,e,r,i,s,o){return y(),g("div",D)}var P=k(A,[["render",F]]);const R={__name:"Form",props:{gscriptID:{type:String,required:!0},siteKey:{type:String,required:!0}},emits:["gsp-beforesubmit","gsp-onsubmit","gsp-oncaptchanotverified"],setup(t,{expose:e,emit:r}){e();const i=t,s=r,o=c(null),l=c(null),u={props:i,emit:s,invisibleHcaptcha:o,form:l,onSubmit:()=>{o.value.execute(),s("gsp-beforesubmit")},onVerify:async(O,j)=>{try{const a=l.value.querySelectorAll("[data-gsp-data]"),d=new URLSearchParams;a.forEach(m=>{d.append(m.dataset.gspName,m.dataset.gspData)});const S=await(await fetch(`https://script.google.com/macros/s/${i.gscriptID}/exec`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()})).json();s("gsp-onsubmit",S,d.toString())}catch(a){s("gsp-onsubmit",a,null)}},onError:()=>{s("gsp-oncaptchanotverified")},ref:c,get VueHcaptcha(){return P}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}};function V(t,e,r,i,s,o){return y(),g("form",E(t.$attrs,{onSubmit:v(i.onSubmit,["prevent"]),ref:"form"}),[_(i.VueHcaptcha,{ref:"invisibleHcaptcha",sitekey:r.siteKey,size:"invisible",theme:"dark",onVerify:i.onVerify,onError:i.onError},null,8,["sitekey"]),x(t.$slots,"default")],16)}const T=C(R,[["render",V]]);export{T as default};
